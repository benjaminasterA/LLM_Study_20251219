# llm_ad_project/
#  â”œâ”€â”€ main.py              # ê´‘ê³  ìƒì„±ê¸° ì‹¤í–‰ íŒŒì¼
#  â”œâ”€â”€ llm_utils.py         # LLM í˜¸ì¶œ í•¨ìˆ˜ ëª¨ë“ˆ
#  â””â”€â”€ prompt_templates.py  # í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ëª¨ìŒ
# 
# [ì£¼ì˜] ì´ íŒŒì¼ë“¤ì€ ìš°ë¦¬ê°€ ì§ì ‘ ë§Œë“  ê²ƒì´ë¯€ë¡œ pipë¡œ ì„¤ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê°™ì€ í´ë”ì— íŒŒì¼ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
# llm_utils.pyì—ì„œ ê¸°ë³¸ ìƒì„± í•¨ìˆ˜(ask_llm)ì™€ í‰ê°€ í•¨ìˆ˜(evaluate_ad)ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
from llm_utils import ask_llm, evaluate_ad
# prompt_templates.pyì—ì„œ ê´‘ê³  ìƒì„± í…œí”Œë¦¿ê³¼ í‰ê°€ í…œí”Œë¦¿ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
from prompt_templates import AD_TEMPLATE, EVALUATOR_TEMPLATE


def generate_ad_copies(product: str, message: str, n: int = 5) -> str:
    """ì„œë¡œ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ì˜ ê´‘ê³  ë¬¸êµ¬ nê°œë¥¼ ìƒì„±í•©ë‹ˆë‹¤."""
    
    # 2. ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬
    # âœï¸ [ê¸°ë¡]: AIì—ê²Œ ì—¬ëŸ¬ ê°œì˜ ê´‘ê³ ë¥¼ ë§Œë“¤ë¼ê³  êµ¬ì²´ì ìœ¼ë¡œ ì§€ì‹œí•˜ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
    prompt = f"""
ë‹¹ì‹ ì€ ë””ì§€í„¸ ë§ˆì¼€íŒ… ì¹´í”¼ë¼ì´í„°ì…ë‹ˆë‹¤.
ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì„œë¡œ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ì˜ ê´‘ê³  ë¬¸êµ¬ë¥¼ {n}ê°œ ì‘ì„±í•˜ì‹œì˜¤.

ì œí’ˆ/ì„œë¹„ìŠ¤: {product}
í•µì‹¬ ë©”ì‹œì§€: {message}

ì¡°ê±´:
- ê° ê´‘ê³  ë¬¸êµ¬ëŠ” 2ë¬¸ì¥ ì´ë‚´
- ë¬¸ì²´ì™€ í‘œí˜„ì€ ì„œë¡œ ë‹¤ë¥´ê²Œ ë³€í˜•
- ë²ˆí˜¸ë¥¼ ë¶™ì—¬ì„œ ì¶œë ¥
"""
    # 3. ì¶”ë¡  ìš”ì²­
    # ğŸ‘† [AI í˜¸ì¶œ]: ì°½ì˜ì„±ì´ í•„ìš”í•˜ë¯€ë¡œ temperatureë¥¼ 0.9ë¡œ ë†’ê²Œ ì„¤ì •í•˜ì—¬ í˜¸ì¶œí•©ë‹ˆë‹¤.
    return ask_llm(prompt, temperature=0.9)


def split_multi_ads(multi_ads: str) -> list:
    """í…ìŠ¤íŠ¸ ë©ì–´ë¦¬ì—ì„œ ë²ˆí˜¸(1. 2. ...)ë¡œ êµ¬ë¶„ëœ ê´‘ê³ ë“¤ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤."""
    
    # 6. ê²°ê³¼ ì²˜ë¦¬ (Data Processing)
    ads = []
    # ğŸ”„ [ë°˜ë³µ]: ì¤„ ë‹¨ìœ„ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë‚˜ëˆ•ë‹ˆë‹¤.
    for line in multi_ads.split("\n"):
        line = line.strip()  # ì•ë’¤ ê³µë°± ì œê±°
        # ğŸ– [ê²€ì‚¬]: ì¤„ì´ ìˆ«ìë¡œ ì‹œì‘í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. (ê°„ë‹¨í•œ íŒŒì‹± ë¡œì§)
        if line.startswith(tuple(str(i) for i in range(1, 10))):  # "1." ~ "9." í™•ì¸
            # ğŸ¤œ [ê²°ê³¼ ì €ì¥]: "1. " ë¶€ë¶„ì„ ì˜ë¼ë‚´ê³  ë‚´ìš©ë§Œ ë¦¬ìŠ¤íŠ¸ì— ë‹´ìŠµë‹ˆë‹¤.
            ad = line.split(".", 1)[1].strip()
            ads.append(ad)
    return ads


def main():
    # í”„ë¡œê·¸ë¨ ì‹œì‘ ì•ˆë‚´
    # ğŸ‘ [ì¶œë ¥]: í”„ë¡œê·¸ë¨ ì œëª©ì„ í‘œì‹œí•©ë‹ˆë‹¤.
    print("=== ê´‘ê³  ì½˜í…ì¸  ìƒì„±ê¸° v3 (Generatorâ€“Evaluator ì ìš©) ===")

    # 1. ëŒ€í™” ì‹œì‘
    # ğŸ‘‡ [ì…ë ¥ ëŒ€ê¸°]: ì‚¬ìš©ìë¡œë¶€í„° ì œí’ˆëª…ê³¼ ë©”ì‹œì§€ë¥¼ ì…ë ¥ë°›ìŠµë‹ˆë‹¤.
    product = input("ì œí’ˆ/ì„œë¹„ìŠ¤ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”: ").strip()
    message = input("í•µì‹¬ ë©”ì‹œì§€ë¥¼ í•œ ì¤„ë¡œ ì…ë ¥í•˜ì„¸ìš”: ").strip()

    # --- â‘  ë‹¨ì¼ ê´‘ê³  ë¬¸êµ¬ ìƒì„± ---
    # 2. ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬
    # âœï¸ [ê¸°ë¡]: ë‹¨ì¼ ìƒì„±ìš© í”„ë¡¬í”„íŠ¸ë¥¼ ì¡°ë¦½í•©ë‹ˆë‹¤.
    single_prompt = AD_TEMPLATE.format(product=product, message=message)
    # ğŸ‘† [AI í˜¸ì¶œ]: AIì—ê²Œ ìƒì„±ì„ ìš”ì²­í•©ë‹ˆë‹¤.
    single_ad = ask_llm(single_prompt, temperature=0.8)

    print("\n[ë‹¨ì¼ ê´‘ê³  ë¬¸êµ¬]")
    print(single_ad)

    # --- â‘¡ 5ì¢… ê´‘ê³  ë¬¸êµ¬ ìƒì„± (Generator) ---
    # ğŸ‘† [AI í˜¸ì¶œ]: í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ AIë¥¼ í˜¸ì¶œí•˜ì—¬ 5ê°œì˜ ê´‘ê³ ë¥¼ í•œ ë²ˆì— ìƒì„±í•©ë‹ˆë‹¤.
    multi_ads = generate_ad_copies(product, message, n=5)

    print("\n[ì„œë¡œ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ì˜ ê´‘ê³  ë¬¸êµ¬ 5ì¢…]")
    print(multi_ads)

    # --- â‘¢ ë²ˆí˜¸ë³„ ë¶„ë¦¬ ---
    # 6. ê²°ê³¼ ì²˜ë¦¬
    # ğŸ‘Œ [ì‹¤í–‰]: í…ìŠ¤íŠ¸ ë©ì–´ë¦¬ë¥¼ ê°œë³„ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    ads_list = split_multi_ads(multi_ads)
    
    print("\n[íŒŒì‹±ëœ ê´‘ê³  ë¦¬ìŠ¤íŠ¸]")
    for i, ad in enumerate(ads_list, start=1):
        print(f"{i}. {ad}")

    # --- â‘£ í‰ê°€ (Evaluator) ---
    scores = []
    print("\n[ê´‘ê³  í‰ê°€ ê²°ê³¼]")
    
    # ğŸ”„ [ë°˜ë³µ]: ìƒì„±ëœ ëª¨ë“  ê´‘ê³ ë¥¼ í•˜ë‚˜ì”© ìˆœíšŒí•˜ë©° ì ìˆ˜ë¥¼ ë§¤ê¹ë‹ˆë‹¤.
    for i, ad in enumerate(ads_list, start=1):
        # ğŸ‘† [AI í˜¸ì¶œ]: evaluate_ad í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ AIê°€ ì‹¬ì‚¬ìœ„ì›(Evaluator)ì´ ë˜ì–´ ì ìˆ˜ë¥¼ ë§¤ê¹ë‹ˆë‹¤.
        score = evaluate_ad(ad, EVALUATOR_TEMPLATE)
        
        # ğŸ¤œ [ê²°ê³¼ ì €ì¥]: ì ìˆ˜ë¥¼ ë¦¬ìŠ¤íŠ¸ì— ëª¨ì•„ë‘¡ë‹ˆë‹¤.
        scores.append(score)
        print(f"{i}ë²ˆ ê´‘ê³  ì´ì : {score}")

    # --- â‘¤ ìµœê³  ì ìˆ˜ ê´‘ê³  ì„ íƒ ---
    # 4. ì˜ì‚¬ ê²°ì • (Decision Making)
    # ğŸ– [ê²€ì‚¬]: ì ìˆ˜ ë¦¬ìŠ¤íŠ¸ì—ì„œ ê°€ì¥ ë†’ì€ ì ìˆ˜ì˜ ìœ„ì¹˜(index)ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
    if scores:  # ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©´
        best_idx = scores.index(max(scores))  # ìµœëŒ€ê°’ì˜ ì¸ë±ìŠ¤ ì°¾ê¸°
        best_ad = ads_list[best_idx]  # í•´ë‹¹ ì¸ë±ìŠ¤ì˜ ê´‘ê³  ë¬¸êµ¬ ê°€ì ¸ì˜¤ê¸°

        # 8. ìµœì¢… ì‘ë‹µ
        # ğŸ‘ [ì¶œë ¥]: ê°€ì¥ í›Œë¥­í•œ ê´‘ê³ ë¥¼ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤ë‹ˆë‹¤.
        print("\n[ë² ìŠ¤íŠ¸ ê´‘ê³  ì„ ì • ê²°ê³¼]")
        print(f"ì„ ì •ëœ ê´‘ê³  ë²ˆí˜¸: {best_idx + 1}")
        print(f"ì ìˆ˜: {scores[best_idx]}")
        print(f"ë² ìŠ¤íŠ¸ ê´‘ê³ :\n{best_ad}")
    else:
        print("\n[ì˜¤ë¥˜] í‰ê°€í•  ê´‘ê³ ê°€ ì¶”ì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")


if __name__ == "__main__":
    main()
